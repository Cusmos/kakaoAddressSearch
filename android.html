<!DOCTYPE html>
<html lang="ko">
<head>
    <title>주소 찾기</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0">
    <style>
        #layer {
            display: block;
            position: absolute;
            overflow: hidden;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
        }
        
        #layer iframe {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            border: none;
            margin: 0;
            padding: 0;
            overflow: hidden;
            min-width: 300px;
        }
    </style>
</head>

<body onload="execDaumPostcode()">
    <div id="layer">
        <iframe frameborder="0" title="커즈미슈즈 주소검색" src="about:blank"></iframe>
    </div>
    
    <script src="https://spi.maps.daum.net/imap/map_js_init/postcode.v2.js"></script>
    <script>
        const AddressSearchHandler = {
            element: document.getElementById('layer'),
            
            init() {
                window.addEventListener("message", this.onReceivedPostMessage.bind(this), false);
            },
            
            onReceivedPostMessage(event) {
                const { action, params } = event.data;
                console.log("Received post message:", { action, params });
            },
            
            onReceivedActivityMessage(json) {
                try {
                    const { action, params } = JSON.parse(json);
                    console.log("Received activity message:", { action, params });
                } catch (error) {
                    console.error("Failed to parse JSON:", error);
                }
            },
            
            getJibunAddress(data) {
                return data.jibunAddress || data.autoJibunAddress || "";
            },
            
            createPostData(data) {
                return {
                    roadAddress: data.roadAddress,
                    jibunAddress: this.getJibunAddress(data),
                    zonecode: data.zonecode
                };
            },
            
            execDaumPostcode() {
                new daum.Postcode({
                    oncomplete: (data) => {
                        const postData = this.createPostData(data);
                        
                        if (window.CusmeApp?.processDATA) {
                            window.CusmeApp.processDATA(
                                postData.roadAddress, 
                                postData.jibunAddress, 
                                postData.zonecode
                            );
                        }
                    },
                    width: '100%',
                    height: '100%'
                }).embed(this.element);
                
                this.element.style.display = 'block';
                this.initLayerPosition();
            },
            
            initLayerPosition() {
                const width = window.innerWidth || document.documentElement.clientWidth;
                const height = window.innerHeight || document.documentElement.clientHeight;
                
                Object.assign(this.element.style, {
                    width: `${width}px`,
                    height: `${height}px`,
                    left: '0px',
                    top: '0px'
                });
            }
        };
        
        // 전역 함수들 (하위 호환성을 위해 유지)
        function execDaumPostcode() {
            AddressSearchHandler.execDaumPostcode();
        }
        
        function onReceivedActivityMessageViaJavascriptInterface(json) {
            AddressSearchHandler.onReceivedActivityMessage(json);
        }
        
        AddressSearchHandler.init();
    </script>
</body>
</html>